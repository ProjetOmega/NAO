{% extends "OmegaNAOBundle::layout.html.twig" %}

{% block head %}
    {{ parent() }}
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="245954021654-njn5rgupo32u6qnn9c86ae2nejhqq9ho.apps.googleusercontent.com">
{% endblock %}

{% block title %}
	Accueil - {{ parent() }}
{% endblock %}

{% block naobundle_body %}
    <div class="container">
        <div class="row"><center><h1>Inscription</h1></center></div>
        <div class="row">

            <div class="g-signin2" data-onsuccess="onSignIn"></div>

            <div class="col-lg-offset-3 col-lg-5 ">
                {{ form_start(formInscription) }}
                {{ form_row(formInscription.nom) }} <br/>
                {{ form_row(formInscription.username) }} <br/>
                {{ form_row(formInscription.email) }} <br/>
                {{ form_row(formInscription.password) }} <br/>
                {{ form_row(formInscription.compte) }} <br/>
                {{ form_row(formInscription.valider) }} <br/>
                {{ form_end(formInscription) }}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script>
        function sendData(id_token, lastname, firstname, email)
        {
            $.ajax({
           type: 'post',
           url: '{{ path('omega_nao_inscription_google')}}',
           data: {idtoken: id_token, lastname: lastname, firstname: firstname, email: email},
           complete: function(resultat, statut){
            document.location.href="{{ path('login') }}";
           }
            });
        }
    </script>
    <script>
      function onSignIn(googleUser) {
        // Useful data for your client-side scripts:
        var profile = googleUser.getBasicProfile();
        console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        console.log('Full Name: ' + profile.getName());
        console.log('Given Name: ' + profile.getGivenName());
        console.log('Family Name: ' + profile.getFamilyName());
        console.log("Image URL: " + profile.getImageUrl());
        console.log("Email: " + profile.getEmail());

        // The ID token you need to pass to your backend:
        var id_token = googleUser.getAuthResponse().id_token;
        console.log("ID Token: " + id_token);

        var lastname = profile.getFamilyName();
        var firstname = profile.getGivenName();
        var email = profile.getEmail();
        
        sendData(id_token, lastname, firstname, email);
      };
    </script>
{% endblock %}
